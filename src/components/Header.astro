---
import { Icon } from 'astro-icon/components';

const navLinks = [
  { href: '#about', label: 'About' },
  { href: '#experience', label: 'Experience' },
  { href: '#skills', label: 'Skills' },
  { href: '#publications', label: 'Publications' },
  { href: '#contact', label: 'Contact' },
];
---

<header
  id="header"
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300"
>
  <nav class="mx-auto max-w-6xl px-4 py-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between">
      <!-- Logo/Name -->
      <a
        href="/"
        class="text-xl font-bold text-text hover:text-accent transition-colors"
      >
        IE
      </a>

      <!-- Desktop Navigation -->
      <ul class="hidden md:flex items-center gap-8">
        {
          navLinks.map((link) => (
            <li>
              <a
                href={link.href}
                class="text-text-muted hover:text-accent transition-colors text-sm font-medium"
              >
                {link.label}
              </a>
            </li>
          ))
        }
      </ul>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-btn"
        class="md:hidden p-2 text-text-muted hover:text-accent transition-colors"
        aria-label="Toggle menu"
        aria-expanded="false"
      >
        <Icon name="lucide:menu" class="w-6 h-6" id="menu-icon" />
        <Icon name="lucide:x" class="w-6 h-6 hidden" id="close-icon" />
      </button>
    </div>

    <!-- Mobile Navigation -->
    <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4 bg-bg rounded-lg border border-border">
      <ul class="flex flex-col gap-2 p-4">
        {
          navLinks.map((link) => (
            <li>
              <a
                href={link.href}
                class="block text-text-muted hover:text-accent transition-colors text-base font-medium py-2 text-right"
              >
                {link.label}
              </a>
            </li>
          ))
        }
      </ul>
    </div>
  </nav>
</header>

<script>
  function initHeader() {
    const header = document.getElementById('header');
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');

    // Header scroll effect
    let lastScroll = 0;
    window.addEventListener('scroll', () => {
      const currentScroll = window.scrollY;

      if (currentScroll > 50) {
        header?.classList.add('bg-bg/80', 'backdrop-blur-md', 'border-b', 'border-border');
      } else {
        header?.classList.remove('bg-bg/80', 'backdrop-blur-md', 'border-b', 'border-border');
      }

      lastScroll = currentScroll;
    });

    // Mobile menu toggle
    mobileMenuBtn?.addEventListener('click', () => {
      const isExpanded = mobileMenuBtn.getAttribute('aria-expanded') === 'true';
      mobileMenuBtn.setAttribute('aria-expanded', (!isExpanded).toString());

      mobileMenu?.classList.toggle('hidden');
      menuIcon?.classList.toggle('hidden');
      closeIcon?.classList.toggle('hidden');
    });

    // Close mobile menu on link click
    mobileMenu?.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', () => {
        mobileMenu.classList.add('hidden');
        menuIcon?.classList.remove('hidden');
        closeIcon?.classList.add('hidden');
        mobileMenuBtn?.setAttribute('aria-expanded', 'false');
      });
    });
  }

  initHeader();
  document.addEventListener('astro:after-swap', initHeader);
</script>
